<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>말씀 챌린지 - 열매 숲</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tailwindplus/elements@1" type="module"></script>
  <link rel="stylesheet" href="./css/animations.css">
</head>
<body class="overflow-hidden h-screen">
  <div class="bg-white h-full flex flex-col">
    <header class="flex-none bg-white sticky top-0 z-20">
      <nav aria-label="Global" class="flex items-center justify-between px-5 py-4 lg:px-7">
        <div class="flex items-center ml-2">
          <a href="/home" class="-m-1 p-1 inline-flex items-center justify-center">
            <span class="sr-only">홈</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" class="w-6 h-6 text-gray-700">
              <path d="m2.25 12 8.954-8.955c.44-.439 1.152-.439 1.591 0L21.75 12M4.5 9.75v10.125c0 .621.504 1.125 1.125 1.125H9.75v-4.875c0-.621.504-1.125 1.125-1.125h2.25c.621 0 1.125.504 1.125 1.125V21h4.125c.621 0 1.125-.504 1.125-1.125V9.75M8.25 21h8.25" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </a>
        </div>
        <div class="flex mr-2">
          <button type="button" command="show-modal" commandfor="mobile-menu" class="-m-2 inline-flex items-center justify-center rounded-md p-2 text-gray-700">
            <span class="sr-only">메뉴 열기</span>
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" data-slot="icon" aria-hidden="true" class="w-6 h-6">
              <path d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          </button>
        </div>
      </nav>
      <div id="sidebar-container"></div>
    </header>

    <!-- Page Title Section (Sticky) -->
    <div class="relative isolate flex-none sticky top-[72px] z-[15] bg-white">
      <div aria-hidden="true" class="absolute inset-x-0 -top-40 -z-10 transform-gpu overflow-hidden blur-3xl sm:-top-80">
        <div style="clip-path: polygon(74.1% 44.1%, 100% 61.6%, 97.5% 26.9%, 85.5% 0.1%, 80.7% 2%, 72.5% 32.5%, 60.2% 62.4%, 52.4% 68.1%, 47.5% 58.3%, 45.2% 34.5%, 27.5% 76.7%, 0.1% 64.9%, 17.9% 100%, 27.6% 76.8%, 76.1% 97.7%, 74.1% 44.1%)" class="relative left-[calc(50%-11rem)] aspect-1155/678 w-144.5 -translate-x-1/2 rotate-30 bg-linear-to-tr from-[#ff9966] to-[#ff6b35] opacity-20 sm:left-[calc(50%-30rem)] sm:w-288.75"></div>
      </div>

      <div class="mx-auto max-w-7xl px-5 lg:px-7 pt-5">
        <div class="text-center relative z-[10000]">
          <div class="flex items-center justify-center gap-3">
            <button id="grove-mode-button" type="button" aria-haspopup="menu" aria-expanded="false" class="group flex cursor-pointer justify-center items-center gap-2 rounded-lg min-h-9 px-3 py-1.5 text-2xl font-bold tracking-tight hover:bg-orange-50 focus-visible:bg-orange-50 focus-visible:outline-none transition-colors whitespace-nowrap">
              <span id="grove-mode-text" class="text-gray-900">나의 과수원</span>
              <svg width="16" height="16" viewBox="0 0 16 16" fill="currentColor" xmlns="http://www.w3.org/2000/svg" class="text-gray-600">
                <path d="M12.1338 5.94433C12.3919 5.77382 12.7434 5.80202 12.9707 6.02929C13.1979 6.25656 13.2261 6.60807 13.0556 6.8662L12.9707 6.9707L8.47067 11.4707C8.21097 11.7304 7.78896 11.7304 7.52926 11.4707L3.02926 6.9707L2.9443 6.8662C2.77379 6.60807 2.80199 6.25656 3.02926 6.02929C3.25653 5.80202 3.60804 5.77382 3.86617 5.94433L3.97067 6.02929L7.99996 10.0586L12.0293 6.02929L12.1338 5.94433Z"></path>
              </svg>
            </button>

            <!-- Dropdown Menu -->
            <div id="grove-mode-menu" class="hidden absolute top-full mt-2 left-1/2 -translate-x-1/2 bg-white rounded-xl shadow-lg border border-gray-200 py-2 min-w-48 max-h-[220px] overflow-y-auto z-[100]">
              <button data-mode="my" class="grove-mode-option w-full text-left px-4 py-2.5 hover:bg-orange-50 transition-colors flex items-center justify-between">
                <span class="text-sm font-medium text-gray-900">나의 과수원</span>
                <svg class="mode-check hidden w-4 h-4 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
              </button>
              <button data-mode="cell" class="grove-mode-option w-full text-left px-4 py-2.5 hover:bg-orange-50 transition-colors flex items-center justify-between">
                <span class="text-sm font-medium text-gray-900">우리 셀의 과수원</span>
                <svg class="mode-check hidden w-4 h-4 text-orange-600" fill="currentColor" viewBox="0 0 20 20">
                  <path fill-rule="evenodd" d="M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z" clip-rule="evenodd"/>
                </svg>
              </button>
              <div class="border-t border-gray-200 my-2"></div>
              <div id="other-cells-container">
                <!-- Dynamically populated cell options will go here -->
                <div class="px-4 py-2.5 text-sm text-gray-500 text-center">로딩 중...</div>
              </div>
            </div>
          </div>
          <p class="mt-1.5 text-sm text-gray-600">말씀으로 가꾼 소중한 열매들</p>
        </div>
      </div>
    </div>

    <!-- View Toggle and Summary Stats (Sticky) -->
    <div class="flex-none sticky top-[180px] z-10 bg-white py-2">
      <div class="mx-auto max-w-7xl px-5 lg:px-7">
        <div class="px-2 flex items-center justify-between">
          <p id="stats-text" class="text-sm text-gray-600">
            전체 <span class="font-semibold text-gray-900">0</span>
          </p>
          <div class="flex items-center gap-3">
            <button id="grid-btn" onclick="toggleView('grid')" class="p-2 rounded-lg bg-orange-100 text-orange-700 transition-colors" title="그리드 뷰">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6A2.25 2.25 0 016 3.75h2.25A2.25 2.25 0 0110.5 6v2.25a2.25 2.25 0 01-2.25 2.25H6a2.25 2.25 0 01-2.25-2.25V6zM3.75 15.75A2.25 2.25 0 016 13.5h2.25a2.25 2.25 0 012.25 2.25V18a2.25 2.25 0 01-2.25 2.25H6A2.25 2.25 0 013.75 18v-2.25zM13.5 6a2.25 2.25 0 012.25-2.25H18A2.25 2.25 0 0120.25 6v2.25A2.25 2.25 0 0118 10.5h-2.25a2.25 2.25 0 01-2.25-2.25V6zM13.5 15.75a2.25 2.25 0 012.25-2.25H18a2.25 2.25 0 012.25 2.25V18A2.25 2.25 0 0118 20.25h-2.25A2.25 2.25 0 0113.5 18v-2.25z" />
              </svg>
            </button>
            <button id="basket-btn" onclick="toggleView('basket')" class="p-2 rounded-lg text-gray-700 hover:bg-gray-100 transition-colors" title="바구니 뷰">
              <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5">
                <path stroke-linecap="round" stroke-linejoin="round" d="M2.25 3h1.386c.51 0 .955.343 1.087.835l.383 1.437M7.5 14.25a3 3 0 00-3 3h15.75m-12.75-3h11.218c1.121-2.3 2.1-4.684 2.924-7.138a60.114 60.114 0 00-16.536-1.84M7.5 14.25L5.106 5.272M6 20.25a.75.75 0 11-1.5 0 .75.75 0 011.5 0zm12.75 0a.75.75 0 11-1.5 0 .75.75 0 011.5 0z" />
              </svg>
            </button>
          </div>
        </div>
      </div>
    </div>

    <!-- Scrollable Content Area -->
    <div class="relative flex-1 overflow-y-auto">
      <div class="mx-auto max-w-7xl px-5 lg:px-7 pt-12 pb-32">
        <!-- Grid View -->
        <div id="grid-view" class="grid grid-cols-1 gap-5 sm:grid-cols-2 lg:grid-cols-3 px-2">
          <!-- Loading Skeleton -->
          <div class="grid-skeleton rounded-xl bg-gray-100 px-4 py-4 animate-pulse">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-x-2">
                <div class="w-10 h-10 bg-gray-200 rounded"></div>
                <div class="space-y-2">
                  <div class="h-3 w-16 bg-gray-200 rounded"></div>
                  <div class="h-3 w-20 bg-gray-200 rounded"></div>
                </div>
              </div>
              <div class="h-3 w-10 bg-gray-200 rounded"></div>
            </div>
          </div>

          <!-- In Progress Fruit (Current Tree) -->
          <div id="current-tree-card" class="hidden relative rounded-xl bg-white px-4 py-4 shadow-sm outline outline-2 -outline-offset-1 outline-green-400 hover:outline-green-500 transition-all hover:shadow-md">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-x-2">
                <span id="current-tree-emoji" class="text-4xl"></span>
                <div>
                  <p id="current-tree-name" class="text-xs font-semibold text-gray-900"></p>
                  <p id="current-tree-date" class="text-xs text-gray-600"></p>
                </div>
              </div>
              <div>
                <p class="text-xs text-green-600 text-right">진행중</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Basket View -->
        <div id="basket-view" class="hidden px-2 mt-16">
          <div class="max-w-3xl mx-auto">
            <!-- Basket Container -->
            <div class="relative bg-gradient-to-br from-amber-100 to-orange-100 rounded-3xl p-7 shadow-lg min-h-96">
              <!-- Basket Rim -->
              <div class="absolute -top-3 left-0 right-0 h-6 bg-gradient-to-b from-amber-800 to-amber-700 rounded-t-3xl border-4 border-amber-900"></div>

              <!-- Basket Weave Pattern -->
              <div class="absolute inset-0 opacity-20 rounded-3xl" style="background-image: repeating-linear-gradient(90deg, transparent, transparent 10px, rgba(120, 53, 15, 0.3) 10px, rgba(120, 53, 15, 0.3) 11px), repeating-linear-gradient(0deg, transparent, transparent 10px, rgba(120, 53, 15, 0.3) 10px, rgba(120, 53, 15, 0.3) 11px);"></div>

              <!-- Fruits in Basket -->
              <div class="relative z-10 flex flex-wrap gap-4 justify-center items-center min-h-80 py-8">
                <!-- In Progress Fruit (smaller, growing) -->
                <div id="current-tree-basket-emoji" class="text-4xl transform hover:scale-110 transition-transform cursor-pointer animate-pulse" title="현재 나무 - 진행중">🌱</div>
              </div>

              <!-- Basket Handle -->
              <div class="absolute -top-16 left-1/2 -translate-x-1/2 w-32 h-20">
                <div class="w-full h-full border-8 border-amber-800 rounded-t-full border-b-0"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>


  <!-- Grove Page Script -->
  <script type="module">
    import { initGrovePage, toggleView } from './js/pages/grovePage.js';
    import { Sidebar } from '/components/sidebar.js';

    // 전역 함수로 노출 (HTML onclick에서 사용)
    window.toggleView = toggleView;

    // 페이지 로드 시 초기화
    document.addEventListener('DOMContentLoaded', function() {
      // 사이드바 렌더링
      const sidebarContainer = document.getElementById('sidebar-container');
      if (sidebarContainer) {
        sidebarContainer.innerHTML = Sidebar.createHTML();
        Sidebar.init();
      }

      initGrovePage();
    });
  </script>
</body>
</html>